---
layout: post
title: 文件上传
date: 2018-8-14
categories: blog
tags: [WEB]
description: 文艺的流氓。
---
# Pass-01 #
 - 使用burp抓个包就可以看的出,就是一个前端JS验证。直接抓包改包绕过。
# Pass-02 #
 - 第二题的是把文件的类型修改为image/jpeg,然后就会被误认为是图片文件.
 - 因为是判断的类型。所以说直接使用burp能够通过
# Pass-03 #
 - 是看了下源码就是把php,asp,aspx,jsp.这些被加入了黑名单,然后在网上找了还有一些其他的的后缀名也可以执行PHP，原因就是符合正则匹配的后缀名都是可以被解析为php脚本的。比如这些：php、php3、php4、php5、phtml、pht。但是在这道题目里面我全部都尝试了一遍，发现只有php3,和phtml可以被上传并且解析。大小写的也是不能够绕过的。
# Pass-04 #
 - 是过滤了文件的后缀名。我自己是没有思路的。但是我看了下网上的操作。是先把上传一个.htaccess.文件。文件的内容就是AddType application/x-httpd-php .whj 大概的意思就是:添加一个.whj的文件是会被解析成PHP文件来执行。所以然后再上传一个.whj为后缀名的文件就可以了。
 - .htaccess文件的用途就是能够实现以下的内容：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定IP地址的用户、只允许特定IP地址的用户、禁止目录列表，以及使用其他文件作为index文件等一些功能。并且其实.htaccess使用的配置语法和httpd.conf一样的。这个文件其实就是便于修改主配置文件。
# Pass-05 #
 - 查看了以下源码，发现是把.htaccess过滤了。但是是没有对大小写进行统一的，所以可以使用大小写进行绕过。
# Pass-06 #
 - 也是查看了一下源码，发现相对于上一题的源码是没有对后缀的首位去空格的。所以能够到后缀名后面加上一个空格就能够绕过
# Pass-07 #
 - 发现源码中是没有去除文件的点(.)号的.那么就是说明可以使用到文件后面加上一个点来进行绕过的。
# Pass-08 #
 - 在源码中是没有判断::$DATA的。所以可以在后缀名后面加上$DATA.就可以绕过了。
 - 那么在windows中的::$DATA就是包含文件内容的。windows是使用NTFS来进行管理的文件的。而::$DATA只是主数据流.Windows中每一个文件对应都是一个MFT记录。而每一个MFT记录是由若干个的属性(attribute)组成的。是用于描述文件的具体信息的。比如$FILE_NAME就是来描述该文件名和创建修改访问的时间。而$DATA是包含了文件的内容。 详情请看 ：[http://www.freebuf.com/articles/73270.html](http://www.freebuf.com/articles/73270.html)
# Pass-09 #
 - 查看了一下源码，就是把之前的那些都过滤了，但是发了一个bug.就是那个去掉点的功能，发现只能去去除一次的点，那么下面接着就是一个去除首尾空格。那么可以构造为1.php. .这样的话过滤之后就是成为1.php.这样的一个文件，但是windows特性就是就会去除点。所以最后会是1.php那么就能够getshel
# Pass-10 #
 - 在源码中发现了是把有问题的后缀名是直接替换成了空。使用了str_ireplace替换字符串的方法。那么这样的话可以使用的就是双后缀名绕过。因为只会替换一次。所以1.pphphp这样的话就可以直接绕过了。
# Pass-11 #
 - 是一个00截断。直接在URL哪里进行00截断，原理就是：%00就是null。而null不管是在那种进制就是属于空的。而语句是会把url和自己上传的文件名拼接在一起。那么意思就是说最后的url会成为这样的1.php%001.png 而GET在解析的时候是从前面往后面进行解析的。所有最后的文件名会是1.php 
# Pass-12 #
 - 同样时一个00截断，不过就是使用的时POST传值方式，那么就是说不能够直接在URL哪里使用00截断，那么就应该在到文件名的后加随意上一个字符串。然后在到十六进制的里面修改为00.那么其实原理就是和上面的一样。
# Pass-13 #
 - 题目的意思就是说上传一个图片马就能够过关。那么直接到windows命令行里面就可以了。copy 1.png+1.php 2.png 就可以生成了。使用的是自定义的函数操作
# Pass-14 #
 - 和十三题同样的操作。我时直接把我做的那个上传了。就过了 使用的就是getimagesize。成功的话返回一个数组，失败返回false
# Pass-15 #
 - 和十三题同样的操作。我时直接把我做的那个上传了。就过了 使用的就是exif_imagetype。读取图像的第一个字节
# Pass-16 #
 - 和十三题同样的操作。我时直接把我做的那个上传了。就过了 
# Pass-17 #
 - 这题目是条件竞争。就是需要在删除文件之前把文件写入进去。那么意思就是说需要让PHP处理的反应不过来。先使用burp设置发空的payload，意思就是说一直发包，直接到payloads中设置就可以了。
# Pass-18 #
 - 这一题的话其实同样都是时间竞争，不过是需要放入图片马。多了一些判断，是判断文件头，文件大小这样的。不过还是能够同样使用Burp来发空包一直发。就能够把文件传上去。不过我自己使用burp发了三千多个包，其中只有1个图片没有被重命名。
# Pass-19 #
 - 这一题我是查看了源码，发现了大小写没有过滤，我以为是就是这么简单，到网上去查看别人的WP发现这道题需要在Linux做。但是在Linux大小写是没有什么说的，那么发现是在POST传参数。那么是可以使用00截断的。也可以直接那样做。就是在save_name是把我们上传的文件给重命名别的文件。那么就到save_name哪里使用00截断。在jpg的前面添加一个PHP然后在使用00截断